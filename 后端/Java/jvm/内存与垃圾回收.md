[TOC]

# 一、JVM与Java体系结构

## 1.1 简介

* 应用程序

  ![image-20200301112249505](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301112249505.png)

  * 运行程序运行在Java API环境下
  * Java API运行在JVM虚拟机之上

* 汇编语言

  ![image-20200301112544321](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301112544321.png)

* Java vs C++

  ![image-20200301113013604](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301113013604.png)

* Java生态圈

  ![image-20200301114328832](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301114328832.png)

* 一次编写，多处运行

  ![image-20200301114406202](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301114406202.png)

* JVM：跨语言的平台

  ![image-20200301114527777](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301114527777.png)

* Java不是最强大的语言，但是JVM是最强的虚拟机。

* Java发展的重大事件

  ![image-20200301115240931](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301115240931.png)

  ![image-20200301115513225](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301115513225.png)

* Open JDK 和 Oracle JDK

  ![image-20200301120634400](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301120634400.png)

* JVM特点

  * 一次编译，到处运行
  * 自动内存管理
  * 自动垃圾回收功能

*  JVM的位置

  ![image-20200301175732383](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301175732383.png)

  ![image-20200301175812765](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301175812765.png)

* JVM的整体结构

  ![image-20200301203709750](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301203709750.png)

* JVM的架构模型

  ![image-20200301205700398](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301205700398.png)

  ![image-20200301205622549](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301205622549.png)

* JVM的生命周期

  ![image-20200301210027394](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301210027394.png)

  ![image-20200301210508967](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301210508967.png)

* 三大虚拟机

  * HotSpot：现在Jdk版本的虚拟机
  * JRockit：仅限服务器端速度，最快的虚拟机
  * J9：号称目前世界上最快的虚拟机

* HotSpot历史

  ![image-20200301211552823](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200301211552823.png)

  

# 二、类加载子系统

![image-20200304211627569](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200304211627569.png)

![image-20200304214151824.png](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200304214151824.png)

* 类加载器中Classloader的角色

![image-20200308145636693](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308145636693.png)

* 类的加载过程

  ![image-20200308145900565](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308145900565.png)

  ![image-20200308145836098](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308145836098.png)
  * 加载

    ![image-20200308145959667](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308145959667.png)

  * 链接

    ![image-20200308150149116](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308150149116.png)

  * 初始化

    ![image-20200308150646091](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308150646091.png)

    

* 类加载器的分类

  * 引导类加载器（Bootstrap ClassLoader） （C/C++语言编写；不可获取）
  * 自定义类加载器（User-Defined ClassLoader）（Java语言编写；可获取）

  ![image-20200308152220015](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308152220015.png)
  

  * Java的核心类库都是由引导类加载器加载的。

* **加载器详细**

  * Bootstrap ClassLoader

    ![image-20200308152751876](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308152751876.png)

  * Extension ClassLoader

    ![image-20200308154622545](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308154622545.png)

  * App ClassLoader

    ![image-20200308154728727](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308154728727.png)

  * 用户自定义类加载器

    ![image-20200308155142433](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308155142433.png)

* 关于ClassLoader

  ![image-20200308155535404](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308155535404.png)

  ![image-20200308155653518](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308155653518.png)

* 获取ClassLoader的途径

  ![image-20200308155726735](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308155726735.png)

* 双亲委派机制

  ![image-20200308155949775](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308155949775.png)

  ![image-20200308160249193](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308160249193.png)

  ![image-20200308160753215](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308160753215.png)

* 沙箱安全机制

  ![image-20200308160957456](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308160957456.png)

* ![image-20200308161128234](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308161128234.png)

* ![image-20200308161207299](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308161207299.png)

* ![image-20200308161401223](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308161401223.png)

# 三、运行时数据区概述及线程

![image-20200308162056630](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308162056630.png) ![image-20200308171027500](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308171027500.png)

![image-20200308172013168](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308172013168.png)

# 四、程序计数器

* 程序计数寄存器

  ![image-20200308172427224](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308172427224.png)

  ![image-20200308172538736](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308172538736.png)

  ![image-20200308175105850](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308175105850.png)

  ![image-20200308175148157](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308175148157.png)

  ![image-20200308193929272](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308193929272.png)

   ![image-20200308194027156](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308194027156.png)

# 五、虚拟机栈

* 内存中的栈和堆

  ![image-20200308194625535](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308194625535.png)

* 基本内容

  ![image-20200308194845291](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308194845291.png)

* 栈的特点

  ![image-20200308195340418](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308195340418.png)

* 虚拟机栈中可能出现的异常

  ![image-20200308195640591](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308195640591.png)

* 设置栈内存大小

  ![image-20200308195758523](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308195758523.png)

* ![image-20200308200148480](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308200148480.png)

  ![image-20200308200325440](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308200325440.png)

  ![image-20200308200351330](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308200351330.png)

  ![image-20200308200905579](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308200905579.png)

  ​	![image-20200308201458037](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308201458037.png)

* 局部变量表

  ![image-20200308201839090](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308201839090.png)

  ![image-20200308202651959](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308202651959.png)

  * 局部变量的slot槽

    ![image-20200308203628905](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308203628905.png)

    ![image-20200308203700007](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308203700007.png)

    slot的重复利用

    ![image-20200308204404737](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308204404737.png)

* 静态变量与局部变量的对比

  ![image-20200308204859841](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308204859841.png)

* ![image-20200308204913320](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308204913320.png)

* 操作数栈

  ![image-20200308205607295](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308205607295.png)

  ![image-20200308205729555](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308205729555.png)

  ![image-20200308205740764](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308205740764.png)

  ![image-20200308205933941](%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20200308205933941.png)



